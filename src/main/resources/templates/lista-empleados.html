<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista de Empleados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h1 th:text="${titulo}">Lista de Empleados</h1>

    <!-- Mensajes Flash -->
    <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show">
        <span th:text="${mensaje}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="mb-3">
        <a th:href="@{/}" class="btn btn-secondary">Inicio</a>
        <a th:href="@{/empleados/nuevo}" class="btn btn-primary">Nuevo Empleado</a>
        <a th:href="@{/empleados/buscar}" class="btn btn-info">Buscar</a>
        <a th:href="@{/salarios}" class="btn btn-success">Calcular Salarios</a>
    </div>

    <div th:if="${empleados != null and !empleados.empty}">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>Nombre</th>
                <th>DNI</th>
                <th>Sexo</th>
                <th>Categoría</th>
                <th>Años</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="empleado : ${empleados}">
                <td th:text="${empleado.nombre}"></td>
                <td>
                    <code th:text="${empleado.dni}"></code>
                </td>
                <td>
                    <span th:if="${empleado.sexo == 'M'}" class="badge bg-primary">Masculino</span>
                    <span th:if="${empleado.sexo == 'F'}" class="badge bg-info">Femenino</span>
                </td>
                <td class="text-center">
                    <span class="badge bg-secondary" th:text="${empleado.categoria}"></span>
                </td>
                <td class="text-center" th:text="${empleado.anyos}"></td>
                <td>
                    <a th:href="@{/salarios/{dni}(dni=${empleado.dni})}"
                       class="btn btn-sm btn-success" title="Calcular salario">
                        Salario
                    </a>
                    <a th:href="@{/empleados/editar/{dni}(dni=${empleado.dni})}"
                       class="btn btn-sm btn-warning" title="Editar empleado">
                        Editar
                    </a>
                    <a th:href="@{/empleados/eliminar/{dni}(dni=${empleado.dni})}"
                       class="btn btn-sm btn-danger"
                       title="Eliminar empleado"
                       onclick="return confirm('¿Estás seguro de eliminar a ' + this.getAttribute('data-nombre') + '?')"
                       th:data-nombre="${empleado.nombre}">
                        Eliminar
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${empleados == null or empleados.empty}" class="alert alert-info">
        <h4>No hay empleados registrados</h4>
        <p>No se encontraron empleados en la base de datos.</p>
        <a th:href="@{/empleados/nuevo}" class="btn btn-primary">Agregar primer empleado</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('a[onclick]');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                const nombre = this.getAttribute('data-nombre');
                if (!confirm('¿Estás seguro de eliminar a ' + nombre + '?')) {
                    e.preventDefault();
                }
            });
        });
    });
</script>
</body>
</html>